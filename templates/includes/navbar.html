{% load static %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'assets/css/theme-switcher.css' %}">
{% endblock extra_styles %}

<header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container-fluid container-xl d-flex align-items-center justify-content-between">

        <a href="{% url 'main' %}" class="logo d-flex align-items-center">
            <!-- <img src="{% static 'assets/img/logo.png' %}" alt=""> -->
            <h1>Cho'girmali Blog</h1>
        </a>

        <nav id="navbar" class="navbar">
            <ul>
                <li><a href="{% url 'blog' %}">Blog</a></li>
                <li><a href="{% url 'about' %}">About</a></li>
                <li><a href="{% url 'contact' %}">Contact</a></li>
            </ul>
        </nav>

        <div class="position-relative d-flex align-items-center">
            <!-- TODO: add dark mode -->
            <ul class="navbar-nav ml-auto">
                <li class="input-group d-flex align-items-center mb-0">
                    <label class="switch theme-switch">
                        <input type="checkbox" checked="" id="themeSwitch">
                        <span class="slider"></span>
                    </label>
                </li>
            </ul>

            <a href="#" class="mx-2 js-search-open"><span class="bi-search"></span></a>
            <i class="bi bi-list mobile-nav-toggle"></i>

            <div class="search-form-wrap js-search-form-wrap">
                <form id="searchForm" class="search-form" method="get" action="{% url 'search' %}">
                    <span class="icon bi-search"></span>
                    <input type="text" name="query" id="searchQuery" placeholder="Search" class="form-control" value="{{ query }}">
                    <button type="submit" class="btn js-search-close"><span class="bi-x"></span></button>
                </form>
            </div>
        </div>
    </div>
</header>

{% block extra_scripts %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
            // Check if the user has a theme preference saved in local storage
            const isDarkMode = localStorage.getItem("darkMode") === "true";

            // Set the initial theme based on the user's preference
            setTheme(isDarkMode);

            // Set the initial state of the switch
            const themeSwitch = document.getElementById("themeSwitch");
            themeSwitch.checked = isDarkMode;

            // Add an event listener to the theme switch
            themeSwitch.addEventListener("change", function () {
                // Toggle the theme on switch change
                const isDarkMode = this.checked;
                setTheme(isDarkMode);
                // Save the theme preference in local storage
                localStorage.setItem("darkMode", JSON.stringify(isDarkMode));
            });

            // Add an event listener to the search input for the "Enter" key press
            const searchInput = document.getElementById("searchQuery");
            searchInput.addEventListener("keydown", function (event) {
                if (event.key === "Enter") {
                    event.preventDefault(); // Prevent the default form submission
                    document.getElementById("searchForm").submit(); // Submit the form
                }
            });

            function setTheme(isDarkMode) {
                const themeStyleLink = document.getElementById("theme-style");
                const markdownStyleLink = document.getElementById("markdown-theme");

                // Update the link to the appropriate CSS file
                themeStyleLink.href = isDarkMode ? "{% static 'assets/css/dark-mode.css' %}" : "{% static 'assets/css/light-mode.css' %}";
                markdownStyleLink.href = isDarkMode ? "{% static 'assets/css/markdown-dark.css' %}" : "{% static 'assets/css/markdown-light.css' %}";

                isDarkMode
                    ? document.body.classList.add("dark-content")
                    : document.body.classList.remove("dark-content");
            }
        });

</script>
{% endblock extra_scripts %}
